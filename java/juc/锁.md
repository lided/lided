# 乐观锁 & 悲观锁

## 悲观锁

### synchronized

1. 普通方法锁 锁当前对象
2. 静态方法锁 锁类对象
3. 代码块锁 锁括号中的对象

lock

## 乐观锁

version控制

CAS

# 公平锁 & 非公平锁


|     | 公平锁             | 非公平锁         |
| --- | --------------- | ------------ |
| 介绍  | 顺序获取锁,先到先得      | 不按照顺序,先抢先得   |
| 性能  | 每次线程切换消耗时间,性能偏低 | 节省线程切换时间,性能高 |

# 可重入锁(递归锁)

同一个线程,获取到方法外部锁,再次进入同一把锁的方法会自动获得锁

1. **synchronized** 通过关键字,无需手动加锁
2. **ReentrantLock()** 通过lock,unlock方法加减锁,并且一个lock方法必须对于一个unlock方法

###### 为什么对象可以作为锁,可重入锁原理?

每个对象都有一个monitor对象(管程,监视器锁)

在hotSpot中,由ObjectMonitor实现,其中有一个锁计数器和指向持有当前锁的线程指针(也有其他变量)

当加锁monitorenter时,锁计数器加一,如果是从0到1指针指向当前线程

当释放锁monitorexit时,计数器减一,如果从1到0指针置空