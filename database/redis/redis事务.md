# 简介

与之前myql事务不同,当事务开启后会将所有操作存放到队列中一次性执行,并且出错后不能回滚

# 使用

使用multi命令开启事务

```
multi
```

输入命令...

输入exec执行队列中全部命令结束事务

```
exec
```

# 错误处理

主动放弃事务

```
discard
```


在事务中如果有语法等编译错误,执行exec命令时所有命令都无法正常运行

如果不是语法错误,例如:incr一个非数字值那么执行exec命令后改命令会报错,事务中其他命令正常执行

# watch监控

乐观锁实现

使用watch命令监控某一数据

```
set k 1
watch k
```

开启事务修改k

```
multi
set k 2
```

如果在还没执行exec命令时k被其他人修改,那么执行exec就会报以下错误

```
127.0.0.1:6379(TX)> exec
(nil)
```

并且该事务队列中其他命令也会失败

取消监控**unwatch**

```
set b 1
watch b
unwatch
```